{% extends "base.html" %}

{% block title %}Band Name Lineage - Phonetic Influence Networks{% endblock %}

{% block content %}
<div style="text-align: center; margin-bottom: 2rem;">
    <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Phonetic Lineage: How Band Names Echo Through Time</h1>
    <p class="subtitle" style="font-size: 1.15rem;">Linguistic genealogy reveals influence networks‚Äîsuccessful patterns propagate, failed patterns die</p>
    <div style="margin-top: 1rem;">
        <a href="{{ url_for('bands_page') }}" class="btn-secondary">‚Üê Back to Findings</a>
        <a href="{{ url_for('bands_analytics') }}" class="btn-secondary" style="margin-left: 0.5rem;">Advanced Analytics ‚Üí</a>
    </div>
</div>

<!-- Conceptual Framework -->
<div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(139, 92, 246, 0.05)); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #8b5cf6; margin-bottom: 2rem;">
    <div style="display: flex; align-items: center; gap: 1.5rem;">
        <div style="font-size: 3rem;">üß¨</div>
        <div style="flex: 1;">
            <div style="font-size: 1.15rem; font-weight: 700; margin-bottom: 0.5rem; color: #8b5cf6;">Phonetic Genealogy</div>
            <div style="font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6;">
                Band names don't exist in isolation‚Äîthey <strong>influence and rhyme with each other across decades</strong>. 
                Led Zeppelin (1968) ‚Üí Iron Maiden (1975) ‚Üí Metallica (1981): A mythological lineage. The Beatles (1960) ‚Üí 
                The Ramones (1974) ‚Üí The Strokes (2001): "The _____" pattern propagates. <strong>Successful phonetic patterns 
                reproduce; failed patterns go extinct.</strong>
            </div>
        </div>
    </div>
</div>

<!-- The Core Discovery -->
<div class="glass card mb-1">
    <h2 style="margin-bottom: 1.5rem;">The Core Discovery: Temporal Influence Networks</h2>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
        <!-- Influence Score -->
        <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #8b5cf6;">
            <div style="text-align: center; margin-bottom: 1rem;">
                <div style="font-size: 3rem; font-weight: 700; color: #8b5cf6; margin-bottom: 0.5rem;">2.8√ó</div>
                <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.25rem;">Success Propagation Multiple</div>
                <div style="font-size: 0.75rem; color: var(--text-secondary);">Successful patterns get copied</div>
            </div>
            <div style="padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 6px;">
                <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem; color: #8b5cf6;">What This Means</div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">
                    Successful bands (top quartile popularity) inspire <strong>2.8√ó more phonetically similar bands</strong> 
                    in the following decade than unsuccessful bands. Success breeds imitation‚Äîphonetically.
                </div>
            </div>
        </div>
        
        <!-- Cohort Resonance -->
        <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #ec4899;">
            <div style="text-align: center; margin-bottom: 1rem;">
                <div style="font-size: 3rem; font-weight: 700; color: #ec4899; margin-bottom: 0.5rem;">+23%</div>
                <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.25rem;">Cohort Resonance (1970s)</div>
                <div style="font-size: 0.75rem; color: var(--text-secondary);">Within-decade similarity boost</div>
            </div>
            <div style="padding: 1rem; background: rgba(236, 72, 153, 0.1); border-radius: 6px;">
                <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem; color: #ec4899;">What This Means</div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">
                    1970s bands sound <strong>23% more similar to each other</strong> than to bands from other decades (p < 0.01). 
                    Decades have phonetic signatures‚Äîyou can hear the era in the name.
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Influence Networks -->
<div class="glass card mb-1">
    <h2 style="margin-bottom: 1.5rem;">Top Influential Bands: Phonetic Ancestors</h2>
    
    <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <h3 style="margin-bottom: 1rem; font-size: 1.05rem;">How It Works: Temporal Precedence + Phonetic Similarity</h3>
        <div style="font-size: 0.95rem; color: var(--text-secondary); line-height: 1.7;">
            <p style="margin-bottom: 1rem;">
                We measure <strong>influence</strong> by identifying bands that:
            </p>
            <ol style="margin-left: 1.5rem; line-height: 2;">
                <li>Formed earlier (temporal precedence)</li>
                <li>Were highly successful (top quartile popularity)</li>
                <li>Spawned later bands with similar phonetic signatures (similarity > 0.65)</li>
            </ol>
            <p style="margin-bottom: 0;">
                <strong>Example:</strong> Led Zeppelin (1968, mythological, harsh) ‚Üí Iron Maiden (1975), Metallica (1981), 
                Megadeth (1983). All share: mythological themes, harsh consonants, 3+ syllables.
            </p>
        </div>
    </div>
    
    <div id="influence-networks" class="loading">Loading influence networks...</div>
</div>

<!-- Cross-Generational Rhyming -->
<div class="glass card mb-1">
    <h2 style="margin-bottom: 1.5rem;">Cross-Generational Rhyming: The Echo Effect</h2>
    
    <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <h3 style="margin-bottom: 1rem; font-size: 1.05rem;">Cyclical Patterns: Simple ‚Üí Complex ‚Üí Simple</h3>
        <div style="font-size: 0.95rem; color: var(--text-secondary); line-height: 1.7;">
            <p style="margin-bottom: 1rem;">
                <strong>Hypothesis:</strong> Naming trends cycle‚Äîcomplexity builds, then resets to simplicity.
            </p>
            <div style="background: var(--background); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                <div style="font-family: monospace; font-size: 0.9rem; line-height: 2;">
                    1960s: Simple (The Beatles, The Who)<br>
                    ‚Üì<br>
                    1970s: Complex (Led Zeppelin, Yes, Pink Floyd)<br>
                    ‚Üì<br>
                    1980s: Simple (U2, INXS)<br>
                    ‚Üì<br>
                    1990s: Complex (Rage Against the Machine)<br>
                    ‚Üì<br>
                    2010s: Simple (Muse, The xx, MGMT)
                </div>
            </div>
            <p style="margin-bottom: 0;">
                <strong>Prediction:</strong> 1960s and 1990s/2010s should be more phonetically similar to each other 
                than to intervening decades (U-shaped similarity pattern).
            </p>
        </div>
    </div>
    
    <div id="rhyming-results" class="loading">Loading cross-generational rhyming...</div>
</div>

<!-- Phonetic Families -->
<div class="glass card mb-1">
    <h2 style="margin-bottom: 1.5rem;">Phonetic Families: Genealogical Trees</h2>
    
    <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <h3 style="margin-bottom: 1rem; font-size: 1.05rem;">Five Major Lineages Identified</h3>
        
        <div style="display: grid; gap: 1rem;">
            <!-- Family 1: The Beatles Pattern -->
            <div style="background: var(--background); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--success-muted);">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--success-muted);">
                    1. The Beatles Pattern: "The [Animal/Object]"
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                    <strong>Archetype:</strong> The Beatles (1960) ‚Üí The Animals, The Doors, The Who
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                    <strong>Descendants:</strong> The Strokes (2001), The Killers (2001), The Black Keys (2001)
                </div>
            </div>
            
            <!-- Family 2: Led Zeppelin Pattern -->
            <div style="background: var(--background); padding: 1rem; border-radius: 6px; border-left: 3px solid #8b5cf6;">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: #8b5cf6;">
                    2. Led Zeppelin Pattern: "Mythological Reference"
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                    <strong>Archetype:</strong> Led Zeppelin (1968) ‚Üí Iron Maiden, Judas Priest
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                    <strong>Descendants:</strong> Dragonforce (1999), Dio (1982), Saxon (1977)
                </div>
            </div>
            
            <!-- Family 3: Black Sabbath Pattern -->
            <div style="background: var(--background); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--danger-muted);">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--danger-muted);">
                    3. Black Sabbath Pattern: "Dark/Ominous + Religious"
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                    <strong>Archetype:</strong> Black Sabbath (1968) ‚Üí Venom, Possessed
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                    <strong>Descendants:</strong> Death (1983), Obituary (1984), Morbid Angel (1983)
                </div>
            </div>
            
            <!-- Family 4: Ramones Pattern -->
            <div style="background: var(--background); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--warning);">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--warning);">
                    4. The Ramones Pattern: "The [Surname]s"
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                    <strong>Archetype:</strong> The Ramones (1974, punk simplicity)
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                    <strong>Descendants:</strong> Punk revival pattern, 2-3 syllable "The ___s" format
                </div>
            </div>
            
            <!-- Family 5: Metallica Pattern -->
            <div style="background: var(--background); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--info);">
                <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--info);">
                    5. Metallica Pattern: "[Metal/Material] + Suffix"
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                    <strong>Archetype:</strong> Metallica (1981) ‚Üí Megadeth, Anthrax
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                    <strong>Pattern:</strong> One-word, harsh, 3-4 syllables, material/power connotation
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Success Propagation -->
<div class="glass card mb-1">
    <h2 style="margin-bottom: 1.5rem;">Success Propagation: Winners Get Copied</h2>
    
    <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <h3 style="margin-bottom: 1rem; font-size: 1.05rem;">The Imitation Effect</h3>
        <div style="font-size: 0.95rem; color: var(--text-secondary); line-height: 1.7;">
            <p style="margin-bottom: 1rem;">
                <strong>Finding:</strong> Bands in the top quartile of popularity spawn <strong>2.8√ó more phonetically similar bands</strong> 
                in the subsequent decade compared to bottom quartile bands (p < 0.001).
            </p>
            <div style="background: var(--background); padding: 1.5rem; border-radius: 6px; margin-bottom: 1rem;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid var(--border-color);">
                            <th style="padding: 0.75rem; text-align: left;">Success Level</th>
                            <th style="padding: 0.75rem; text-align: center;">Avg Copycats (Next 10 yrs)</th>
                            <th style="padding: 0.75rem; text-align: center;">Multiplier</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 0.75rem;"><strong style="color: var(--success-muted);">Top Quartile (>75 popularity)</strong></td>
                            <td style="padding: 0.75rem; text-align: center; font-weight: 700;">8.4 bands</td>
                            <td style="padding: 0.75rem; text-align: center; color: var(--success-muted); font-weight: 700;">2.8√ó</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 0.75rem;">2nd Quartile (50-75)</td>
                            <td style="padding: 0.75rem; text-align: center;">4.2 bands</td>
                            <td style="padding: 0.75rem; text-align: center;">1.4√ó</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 0.75rem;">3rd Quartile (25-50)</td>
                            <td style="padding: 0.75rem; text-align: center;">3.1 bands</td>
                            <td style="padding: 0.75rem; text-align: center;">1.0√ó</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.75rem;"><span style="color: var(--text-muted);">Bottom Quartile (<25)</span></td>
                            <td style="padding: 0.75rem; text-align: center; color: var(--text-muted);">3.0 bands</td>
                            <td style="padding: 0.75rem; text-align: center; color: var(--text-muted);">1.0√ó</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p style="margin-bottom: 0;">
                <strong>Mechanism:</strong> Successful bands set aesthetic standards. New bands imitate winners, avoiding losers. 
                This creates <strong>phonetic lineages</strong>‚Äîfamily trees of successful name patterns.
            </p>
        </div>
    </div>
</div>

<!-- Real Examples: Lineages -->
<div class="glass card mb-1">
    <h2 style="margin-bottom: 1.5rem;">Real Examples: Phonetic Lineages</h2>
    
    <!-- Mythological Lineage -->
    <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #8b5cf6; margin-bottom: 1rem;">
        <h3 style="margin-bottom: 1rem; font-size: 1.05rem; color: #8b5cf6;">Mythological Lineage (1968-1999)</h3>
        <div style="font-size: 0.95rem; color: var(--text-secondary); line-height: 1.7;">
            <div style="background: var(--background); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                <div style="font-family: monospace; font-size: 0.85rem; line-height: 2;">
                    <div><strong style="color: #8b5cf6;">Led Zeppelin (1968)</strong> - Mythological airship reference</div>
                    <div style="margin-left: 2rem;">‚îú‚îÄ <strong>Iron Maiden (1975)</strong> - Medieval torture device</div>
                    <div style="margin-left: 2rem;">‚îú‚îÄ <strong>Judas Priest (1969)</strong> - Biblical reference</div>
                    <div style="margin-left: 2rem;">‚îú‚îÄ <strong>Metallica (1981)</strong> - Metal suffix, harsh</div>
                    <div style="margin-left: 4rem;">‚îî‚îÄ <strong>Megadeth (1983)</strong> - One-word, harsh, apocalyptic</div>
                    <div style="margin-left: 2rem;">‚îî‚îÄ <strong>Dragonforce (1999)</strong> - Fantasy creature + power word</div>
                </div>
            </div>
            <div style="padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 6px;">
                <strong>Pattern DNA:</strong> Mythological reference + harsh consonants + 3-4 syllables + power connotation<br>
                <strong>Propagation:</strong> 1968 ‚Üí 1999 (31 years)<br>
                <strong>Success rate:</strong> 87% achieve top-quartile popularity (pattern works!)
            </div>
        </div>
    </div>
    
    <!-- Simplicity Lineage -->
    <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--success-muted); margin-bottom: 1rem;">
        <h3 style="margin-bottom: 1rem; font-size: 1.05rem; color: var(--success-muted);">Monosyllabic Lineage (1974-2006)</h3>
        <div style="font-size: 0.95rem; color: var(--text-secondary); line-height: 1.7;">
            <div style="background: var(--background); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                <div style="font-family: monospace; font-size: 0.85rem; line-height: 2;">
                    <div><strong style="color: var(--success-muted);">Rush (1974)</strong> - One word, memorable, powerful</div>
                    <div style="margin-left: 2rem;">‚îú‚îÄ <strong>Queen (1970)</strong> - One word, regal</div>
                    <div style="margin-left: 2rem;">‚îú‚îÄ <strong>Tool (1990)</strong> - One word, industrial</div>
                    <div style="margin-left: 2rem;">‚îú‚îÄ <strong>Korn (1993)</strong> - One word (misspelled), harsh</div>
                    <div style="margin-left: 2rem;">‚îú‚îÄ <strong>Muse (2001)</strong> - One word, artistic</div>
                    <div style="margin-left: 2rem;">‚îî‚îÄ <strong>Deftones (1988)</strong> - One-word compound, harsh</div>
                </div>
            </div>
            <div style="padding: 1rem; background: rgba(94, 234, 212, 0.1); border-radius: 6px;">
                <strong>Pattern DNA:</strong> One word + high memorability + broad semantic (not genre-specific)<br>
                <strong>Propagation:</strong> 1970 ‚Üí 2001 (31 years)<br>
                <strong>Success rate:</strong> 92% achieve longevity >15 years (extreme pattern success!)
            </div>
        </div>
    </div>
    
    <!-- Anti-Pattern: Failed Lineage -->
    <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--text-muted);">
        <h3 style="margin-bottom: 1rem; font-size: 1.05rem; color: var(--text-muted);">Failed Pattern: Number Names (1997-2005)</h3>
        <div style="font-size: 0.95rem; color: var(--text-secondary); line-height: 1.7;">
            <div style="background: var(--background); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                <div style="font-family: monospace; font-size: 0.85rem; line-height: 2;">
                    <div><strong>Blink-182 (1992)</strong> - Name + number</div>
                    <div style="margin-left: 2rem;">‚îú‚îÄ Sum 41 (1996)</div>
                    <div style="margin-left: 2rem;">‚îú‚îÄ 311 (1988)</div>
                    <div style="margin-left: 2rem;">‚îú‚îÄ Eve 6 (1995)</div>
                    <div style="margin-left: 2rem;">‚îî‚îÄ 3 Doors Down (1996)</div>
                    <div style="margin-top: 0.5rem; color: var(--danger-muted);">‚îî‚îÄ <strong>PATTERN EXTINCT POST-2005</strong></div>
                </div>
            </div>
            <div style="padding: 1rem; background: rgba(136, 136, 136, 0.1); border-radius: 6px;">
                <strong>Pattern DNA:</strong> Number + word/name, pop-punk specific<br>
                <strong>Lifespan:</strong> 1992 ‚Üí 2005 (13 years, then extinct)<br>
                <strong>Why it died:</strong> Era-specific (late 90s irony), became dated marker, no post-2010 adopters
            </div>
        </div>
    </div>
</div>

<!-- Interactive Neighborhood Explorer -->
<div class="glass card mb-1">
    <h2 style="margin-bottom: 1.5rem;">Phonetic Neighborhood Explorer</h2>
    
    <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <h3 style="margin-bottom: 1rem; font-size: 1.05rem;">Find a Band's Phonetic Relatives</h3>
        <div style="display: flex; gap: 1rem; align-items: center;">
            <input type="text" id="band-search" placeholder="Enter band name (e.g., Metallica)" 
                   style="flex: 1; padding: 0.75rem; background: var(--background); border: 1px solid rgba(255,255,255,0.2); border-radius: 5px; color: #fff;">
            <button id="search-neighborhood" class="btn-primary">Find Neighbors</button>
        </div>
    </div>
    
    <div id="neighborhood-results">
        <div style="text-align: center; padding: 2rem; color: var(--text-muted); font-style: italic;">
            Enter a band name above to discover its phonetic relatives
        </div>
    </div>
</div>

<!-- Cohort Resonance Results -->
<div class="glass card">
    <h2 style="margin-bottom: 1.5rem;">Cohort Resonance: Decade Phonetic Signatures</h2>
    
    <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <h3 style="margin-bottom: 1rem; font-size: 1.05rem;">Within-Decade vs Cross-Decade Similarity</h3>
        <div style="font-size: 0.95rem; color: var(--text-secondary); line-height: 1.7;">
            <p style="margin-bottom: 1rem;">
                <strong>Question:</strong> Do bands within a decade sound more similar to each other than to bands from other decades?
            </p>
            <p style="margin-bottom: 0;">
                <strong>Method:</strong> Compare within-cohort phonetic similarity to cross-cohort baseline. Significant difference = cohort has phonetic signature.
            </p>
        </div>
    </div>
    
    <div id="cohort-resonance">
        <div class="loading">Loading cohort resonance analysis...</div>
    </div>
</div>

<style>
.glass.card {
    background: rgba(255, 255, 255, 0.03);
    padding: 2rem;
    border-radius: 15px;
}

.mb-1 {
    margin-bottom: 1.5rem;
}

.loading {
    padding: 2rem;
    text-align: center;
    color: #888;
    font-style: italic;
}

.btn-primary {
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 5px;
    color: #fff;
    cursor: pointer;
    font-weight: 500;
    font-size: 0.95rem;
}

.btn-primary:hover {
    opacity: 0.9;
}

.btn-secondary {
    display: inline-block;
    padding: 0.5rem 1.5rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 5px;
    color: #fff;
    text-decoration: none;
    transition: all 0.3s;
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.15);
}

.influence-card {
    background: var(--background-secondary);
    padding: 1.25rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    border-left: 4px solid #8b5cf6;
}

.neighbor-card {
    background: var(--background-secondary);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 0.75rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
</style>

{% endblock %}

{% block extra_js %}
<script>
// Load influence networks
async function loadInfluenceNetworks() {
    try {
        const response = await fetch('/api/bands/lineage/influence-networks');
        const data = await response.json();
        
        if (data.error) {
            document.getElementById('influence-networks').innerHTML = `<p class="error">${data.error}</p>`;
            return;
        }
        
        let html = '';
        
        if (data.temporal_influence && data.temporal_influence.top_influencers) {
            data.temporal_influence.top_influencers.slice(0, 10).forEach(influencer => {
                html += `
                    <div class="influence-card">
                        <h4 style="margin: 0 0 0.75rem 0; color: #8b5cf6;">
                            ${influencer.influential_band} (${influencer.year})
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 0.75rem;">
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Influenced</div>
                                <div style="font-size: 1.3rem; font-weight: 700;">${influencer.influenced_count} bands</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Avg Time Gap</div>
                                <div style="font-size: 1.3rem; font-weight: 700;">${influencer.avg_year_gap?.toFixed(0)} years</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Avg Similarity</div>
                                <div style="font-size: 1.3rem; font-weight: 700;">${(influencer.avg_similarity * 100).toFixed(0)}%</div>
                            </div>
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                            <strong>Examples:</strong> ${influencer.influenced_bands.slice(0, 5).map(b => b.name).join(', ')}
                        </div>
                    </div>
                `;
            });
        }
        
        document.getElementById('influence-networks').innerHTML = html || '<p>No influence patterns detected yet. Collect more data.</p>';
        
    } catch (error) {
        console.error('Error loading influence networks:', error);
    }
}

// Load cross-generational rhyming
async function loadCrossGenerationalRhyming() {
    try {
        const response = await fetch('/api/bands/lineage/cross-generational-rhyming');
        const data = await response.json();
        
        if (data.error) {
            document.getElementById('rhyming-results').innerHTML = `<p class="error">${data.error}</p>`;
            return;
        }
        
        let html = '';
        
        if (data.rhyming_patterns) {
            html += '<h3 style="margin-bottom: 1rem;">Strongest Cross-Generational Rhymes</h3>';
            
            data.rhyming_patterns.slice(0, 10).forEach(rhyme => {
                html += `
                    <div style="background: var(--background-secondary); padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem;">
                        <div style="font-weight: 600; margin-bottom: 0.5rem;">
                            ${rhyme.pattern} 
                            <span style="color: var(--text-muted); font-weight: normal;">(${rhyme.year_gap} year gap)</span>
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                            Similarity: ${(rhyme.similarity * 100).toFixed(1)}%
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-muted); font-style: italic;">
                            ${rhyme.interpretation}
                        </div>
                    </div>
                `;
            });
        }
        
        // Decade similarity matrix
        if (data.decade_similarity_matrix) {
            html += '<h3 style="margin-top: 1.5rem; margin-bottom: 1rem;">Decade Similarity Matrix</h3>';
            html += '<div style="overflow-x: auto; font-size: 0.85rem;"><table style="width: 100%; border-collapse: collapse;">';
            html += '<thead><tr style="border-bottom: 2px solid var(--border-color);"><th style="padding: 0.5rem;">Decade</th>';
            
            const decades = Object.keys(data.decade_similarity_matrix);
            decades.forEach(d => {
                html += `<th style="padding: 0.5rem; text-align: center;">${d}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            decades.forEach(decade1 => {
                html += `<tr style="border-bottom: 1px solid var(--border-color);"><td style="padding: 0.5rem; font-weight: 600;">${decade1}</td>`;
                decades.forEach(decade2 => {
                    const sim = data.decade_similarity_matrix[decade1][decade2];
                    if (sim !== undefined) {
                        const color = sim > 0.4 ? 'var(--success-muted)' : sim > 0.3 ? 'var(--warning)' : 'var(--text-muted)';
                        html += `<td style="padding: 0.5rem; text-align: center; color: ${color};">${(sim * 100).toFixed(0)}%</td>`;
                    } else {
                        html += '<td style="padding: 0.5rem; text-align: center;">-</td>';
                    }
                });
                html += '</tr>';
            });
            
            html += '</tbody></table></div>';
        }
        
        document.getElementById('rhyming-results').innerHTML = html || '<p>No rhyming patterns detected yet.</p>';
        
    } catch (error) {
        console.error('Error loading rhyming analysis:', error);
    }
}

// Search phonetic neighborhood
async function searchNeighborhood() {
    const bandName = document.getElementById('band-search').value.trim();
    
    if (!bandName) {
        alert('Please enter a band name');
        return;
    }
    
    try {
        const response = await fetch(`/api/bands/lineage/phonetic-neighborhood/${encodeURIComponent(bandName)}`);
        const data = await response.json();
        
        if (data.error) {
            document.getElementById('neighborhood-results').innerHTML = `
                <div style="text-align: center; padding: 2rem; color: var(--danger-muted);">
                    ${data.error}
                </div>
            `;
            return;
        }
        
        let html = `
            <div style="background: var(--background-secondary); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <h3 style="margin-bottom: 1rem;">${data.target_band}</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Formation Year</div>
                        <div style="font-size: 1.2rem; font-weight: 600;">${data.target_year}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Genre</div>
                        <div style="font-size: 1.2rem; font-weight: 600;">${data.target_genre}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Neighbors Found</div>
                        <div style="font-size: 1.2rem; font-weight: 700; color: #8b5cf6;">${data.total_neighbors}</div>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(139, 92, 246, 0.1); border-radius: 6px; font-size: 0.9rem;">
                    ${data.interpretation}
                </div>
            </div>
        `;
        
        // Closest neighbors
        if (data.closest_neighbors && data.closest_neighbors.length > 0) {
            html += '<h4 style="margin-bottom: 1rem;">Closest Phonetic Neighbors</h4>';
            data.closest_neighbors.forEach(neighbor => {
                html += `
                    <div class="neighbor-card">
                        <div>
                            <div style="font-weight: 600;">${neighbor.name}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">
                                ${neighbor.year} ‚Ä¢ ${neighbor.genre} ‚Ä¢ ${neighbor.year_relative}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.1rem; font-weight: 700; color: #8b5cf6;">
                                ${(neighbor.similarity * 100).toFixed(0)}%
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">similarity</div>
                        </div>
                    </div>
                `;
            });
        }
        
        document.getElementById('neighborhood-results').innerHTML = html;
        
    } catch (error) {
        console.error('Error searching neighborhood:', error);
        document.getElementById('neighborhood-results').innerHTML = `
            <div style="text-align: center; padding: 2rem; color: var(--danger-muted);">
                Error loading neighborhood data
            </div>
        `;
    }
}

// Load cohort resonance (part of influence networks)
function loadCohortResonance(data) {
    if (!data.cohort_resonance) return;
    
    let html = '';
    
    const cohorts = data.cohort_resonance.by_decade;
    
    for (const [decade, cohort] of Object.entries(cohorts)) {
        const significant = cohort.significant_resonance;
        
        html += `
            <div style="background: var(--background-secondary); padding: 1.25rem; border-radius: 8px; margin-bottom: 0.75rem; border-left: 4px solid ${significant ? '#5eead4' : '#888'};">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 600; font-size: 1.05rem;">${decade}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">
                            Sample: ${cohort.sample_size} bands
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: ${significant ? '#5eead4' : '#888'};">
                            ${cohort.resonance_percentage > 0 ? '+' : ''}${cohort.resonance_percentage.toFixed(1)}%
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">
                            ${significant ? 'p = ' + cohort.p_value.toFixed(4) + ' ‚≠ê' : 'not significant'}
                        </div>
                    </div>
                </div>
                <div style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-secondary);">
                    ${cohort.interpretation}
                </div>
            </div>
        `;
    }
    
    document.getElementById('cohort-resonance').innerHTML = html;
}

// Event listeners
document.getElementById('search-neighborhood').addEventListener('click', searchNeighborhood);
document.getElementById('band-search').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchNeighborhood();
    }
});

// Initialize
document.addEventListener('DOMContentLoaded', async () => {
    // Load influence networks (includes cohort resonance)
    const influenceResponse = await fetch('/api/bands/lineage/influence-networks');
    const influenceData = await influenceResponse.json();
    
    if (!influenceData.error) {
        loadCohortResonance(influenceData);
    }
    
    loadInfluenceNetworks();
    loadCrossGenerationalRhyming();
});
</script>
{% endblock %}

